(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{970:function(e,t,r){Promise.resolve().then(r.bind(r,4931))},4931:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(7437),i=r(2265);class u{addTexture(){if(!this.alive)return;let e=this.device.createTexture({size:[4096,4096],format:"rgba8unorm",dimension:"2d",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),t=this.device.createCommandEncoder();return this.device.queue.submit([t.finish()]),this.textures.push(e),e}getMemoryUsage(){return this.textures.reduce((e,t)=>e+t.width*t.height*4,0)}static async fromNavigator(){let e=await navigator.gpu.requestAdapter();if(!e)throw Error("WebGPU not supported");return new u(await e.requestDevice())}constructor(e){this.device=e,this.textures=[],this.alive=!0,e.lost.then(e=>{console.error("GPU Device lost",e),this.alive=!1}),e.onuncapturederror=e=>{console.error("GPU Uncaptured error",e)}}}function s(){let e=function(){let[e,t]=(0,i.useState)();return(0,i.useEffect)(()=>{u.fromNavigator().then(e=>t(e))},[t]),e}(),t=function(){let e=(0,i.useRef)(),[t]=(0,i.useState)(function(e){function t(){clearTimeout(e.current),clearInterval(e.current),e.current=void 0}return{timeoutRef:e,clear:t,startInterval:function(r,n,i){t(),e.current=setInterval(r,n),i&&r()},startTimeout:function(r,n){t(),e.current=setTimeout(()=>{r(),t()},n)}}}(e));return t}(),{canvasRef:r}=function(){let e=(0,i.useRef)(null),[t,r]=(0,i.useState)();return(0,i.useEffect)(()=>{if(!t)return;let e=t.getContext("2d");e&&(e.fillStyle="green",e.fillRect(0,0,t.width,t.height),e.fillStyle="black",e.font="bold 48px courier",e.textAlign="center",e.fillText("gpu is OK",t.width/2,t.height/2))},[t]),e.current&&!t&&r(e.current),{canvasRef:e,canvas:t}}(),[s,c]=(0,i.useState)(!1),l=(0,i.useCallback)(()=>{null==e||e.addTexture(),c(e=>!e)},[e,c]),o=(0,i.useCallback)(()=>{t.startInterval(l,100),c(e=>!e)},[t,c]),a=(0,i.useCallback)(()=>{t.clear(),c(e=>!e)},[t,c]);return(0,i.useEffect)(()=>{t.timeoutRef&&(null==e?void 0:e.alive)===!1&&(t.clear(),c(e=>!e))},[t,c]),(0,n.jsxs)("main",{style:{textAlign:"center",margin:"2em"},children:[(0,n.jsx)("h1",{children:"GPU Test"}),e?(0,n.jsxs)(n.Fragment,{children:[t.timeoutRef?(0,n.jsx)("p",{children:(0,n.jsx)("button",{onClick:a,children:"Stop Auto"})}):(0,n.jsxs)("p",{children:[(0,n.jsx)("button",{onClick:o,children:"Start Auto"}),(0,n.jsx)("br",{}),(0,n.jsx)("button",{onClick:l,children:"Add Texture"})]}),(0,n.jsxs)("p",{children:["Allocated memory: ",function(e){let t=e,r=["Bytes","KB","MB","GB","TB"],n=[0,0,1,2,3];for(;t>1024;)t/=1024,r.shift(),n.shift();return"".concat(t.toFixed(n[0])," ").concat(r[0])}(e.getMemoryUsage())]})]}):(0,n.jsx)("div",{children:"loading..."}),(0,n.jsx)("canvas",{ref:r,width:400,height:200})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=970)}),_N_E=e.O()}]);